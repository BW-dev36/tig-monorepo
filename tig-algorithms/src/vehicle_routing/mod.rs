pub mod clarke_wright;
pub mod clarke_wright_ultimate;

#[cfg(test)]
mod tests {
    use std::time::Instant;

    use super::*;
    use tig_challenges::{vehicle_routing::*, *};

    #[test]
    fn test_vehicle() {
        let difficulties2 = [[92, 326]];
        let difficulties = [
            [92, 326],
            [62, 372],
            [96, 321],
            [149, 275],
            [63, 370],
            [79, 344],
            [133, 282],
            [99, 321],
            [63, 373],
            [77, 348],
            [70, 362],
            [111, 305],
            [109, 307],
            [132, 281],
            [131, 282],
            [72, 362],
            [68, 369],
            [60, 378],
            [80, 342],
            [106, 309],
            [130, 283],
            [73, 361],
            [126, 287],
            [111, 304],
            [72, 361],
            [67, 366],
            [80, 344],
            [88, 330],
            [62, 373],
            [72, 358],
            [107, 311],
            [125, 292],
            [91, 332],
            [148, 275],
            [87, 334],
            [103, 310],
            [114, 298],
            [130, 281],
            [74, 357],
            [120, 296],
            [105, 310],
            [101, 310],
            [135, 279],
            [81, 342],
            [90, 330],
            [133, 279],
            [98, 318],
            [140, 277],
            [88, 334],
            [117, 300],
            [108, 310],
            [116, 299],
            [137, 278],
            [100, 322],
            [122, 293],
            [59, 381],
            [142, 277],
            [119, 296],
            [103, 311],
            [113, 299],
            [106, 307],
            [60, 377],
            [95, 324],
            [69, 361],
            [79, 347],
            [119, 293],
            [71, 359],
            [83, 342],
            [113, 301],
            [91, 329],
            [84, 338],
            [87, 337],
            [104, 309],
            [130, 284],
            [105, 312],
            [93, 328],
            [75, 355],
            [86, 338],
            [57, 390],
            [62, 371],
            [84, 337],
            [80, 343],
            [138, 278],
            [129, 285],
            [66, 368],
            [69, 366],
            [105, 309],
            [77, 351],
            [76, 349],
            [76, 354],
            [98, 317],
            [122, 290],
            [125, 289],
            [112, 302],
            [70, 359],
            [104, 314],
            [124, 289],
            [99, 319],
            [97, 319],
            [67, 363],
            [95, 328],
            [95, 326],
            [123, 292],
            [101, 313],
            [93, 325],
            [134, 279],
            [57, 384],
            [105, 308],
            [71, 358],
            [78, 349],
            [91, 330],
            [107, 312],
            [85, 341],
            [135, 280],
            [104, 313],
            [71, 361],
            [57, 388],
            [82, 341],
            [102, 315],
            [67, 365],
            [61, 377],
            [119, 298],
            [141, 278],
            [75, 354],
            [136, 279],
            [120, 294],
            [123, 291],
            [104, 310],
            [55, 397],
            [113, 305],
            [56, 390],
            [83, 338],
            [113, 302],
            [80, 345],
            [72, 357],
            [74, 362],
            [111, 308],
            [92, 328],
            [79, 346],
            [135, 281],
            [115, 299],
            [105, 314],
            [122, 292],
            [120, 298],
            [62, 370],
            [108, 307],
            [101, 314],
            [101, 317],
            [110, 307],
            [97, 320],
            [118, 298],
            [128, 288],
            [116, 297],
            [65, 368],
            [80, 349],
            [102, 318],
            [89, 329],
            [85, 335],
            [120, 293],
            [111, 300],
            [58, 380],
            [137, 279],
            [106, 308],
            [64, 370],
            [116, 300],
            [140, 278],
            [62, 375],
            [69, 362],
            [68, 365],
            [92, 329],
            [136, 278],
            [78, 346],
            [87, 336],
            [76, 352],
            [110, 305],
            [83, 344],
            [59, 380],
            [136, 281],
            [146, 275],
            [131, 283],
            [128, 287],
            [65, 366],
            [106, 310],
            [137, 280],
            [79, 348],
            [125, 288],
            [84, 341],
            [83, 339],
            [66, 369],
            [128, 282],
            [85, 340],
            [132, 283],
            [86, 336],
            [108, 304],
            [139, 278],
            [56, 388],
            [120, 292],
            [89, 332],
            [63, 369],
            [83, 340],
            [77, 352],
            [120, 291],
            [61, 378],
            [75, 347],
            [61, 371],
            [131, 286],
            [123, 294],
            [124, 292],
            [110, 306],
            [120, 295],
            [111, 303],
            [123, 289],
            [103, 315],
            [100, 315],
            [103, 312],
            [102, 311],
            [88, 336],
            [123, 293],
            [130, 282],
            [58, 386],
            [76, 353],
            [110, 303],
            [104, 315],
            [106, 311],
            [95, 322],
            [94, 323],
            [113, 304],
            [86, 334],
            [134, 282],
            [67, 364],
            [129, 284],
            [78, 348],
            [80, 348],
            [94, 326],
            [128, 284],
            [115, 300],
            [85, 342],
            [118, 296],
            [88, 332],
            [114, 301],
            [94, 328],
            [69, 363],
            [87, 333],
            [93, 329],
            [129, 286],
            [147, 275],
            [86, 337],
            [56, 393],
            [126, 286],
            [73, 356],
            [74, 354],
            [94, 330],
            [96, 323],
            [68, 363],
            [61, 373],
            [134, 281],
            [76, 351],
            [124, 291],
            [87, 335],
            [100, 318],
            [71, 364],
            [102, 313],
            [62, 369],
            [70, 361],
            [67, 367],
            [105, 311],
            [123, 290],
            [93, 326],
            [121, 293],
            [122, 289],
            [96, 320],
            [63, 372],
            [82, 346],
            [114, 303],
            [114, 302],
            [72, 360],
            [63, 371],
            [104, 311],
            [132, 280],
            [109, 304],
            [131, 285],
            [102, 314],
            [63, 368],
            [67, 369],
            [59, 383],
            [69, 360],
            [112, 303],
            [133, 281],
            [135, 278],
            [107, 308],
            [81, 344],
            [59, 382],
            [106, 313],
            [125, 290],
            [129, 282],
            [127, 288],
            [112, 305],
            [107, 309],
            [107, 307],
            [73, 357],
            [100, 319],
            [118, 297],
            [96, 322],
            [150, 275],
            [75, 356],
            [106, 312],
            [99, 316],
            [73, 350],
            [70, 365],
            [85, 337],
            [108, 306],
            [100, 314],
            [75, 353],
            [90, 334],
            [83, 341],
            [97, 324],
            [81, 343],
            [78, 351],
            [93, 327],
            [56, 392],
            [55, 394],
            [70, 364],
            [85, 339],
            [111, 301],
            [71, 363],
            [79, 351],
            [107, 310],
            [112, 301],
            [70, 360],
            [57, 391],
            [99, 320],
            [98, 319],
            [60, 376],
            [55, 392],
            [82, 344],
            [57, 387],
            [84, 340],
            [116, 298],
            [89, 331],
            [127, 285],
            [80, 347],
            [103, 314],
            [126, 289],
            [124, 293],
            [56, 397],
            [126, 288],
            [97, 323],
            [89, 334],
            [127, 286],
            [111, 302],
            [112, 300],
            [127, 283],
            [122, 294],
            [122, 291],
            [118, 295],
            [128, 283],
            [129, 287],
            [104, 312],
            [86, 333],
            [126, 290],
            [126, 284],
            [75, 351],
            [109, 306],
            [127, 287],
            [97, 322],
            [128, 285],
            [65, 367],
            [58, 381],
            [109, 302],
            [82, 339],
            [90, 328],
            [120, 299],
            [84, 339],
            [55, 399],
            [88, 331],
            [99, 317],
            [144, 276],
            [133, 280],
            [95, 323],
            [138, 277],
            [90, 329],
            [73, 359],
            [111, 306],
            [63, 374],
            [57, 383],
            [94, 325],
            [72, 359],
            [119, 299],
            [108, 309],
            [78, 347],
            [92, 331],
            [98, 322],
            [66, 366],
            [64, 368],
            [124, 287],
            [112, 304],
            [88, 333],
            [55, 395],
            [71, 360],
            [114, 300],
            [121, 291],
            [56, 389],
            [74, 358],
            [139, 277],
            [60, 380],
            [117, 297],
            [125, 286],
            [127, 284],
            [95, 325],
            [68, 362],
            [142, 276],
            [126, 285],
            [128, 286],
            [131, 284],
            [110, 302],
            [60, 374],
            [93, 324],
            [117, 299],
            [106, 306],
            [96, 324],
            [121, 292],
            [61, 376],
            [118, 294],
            [84, 336],
            [74, 356],
            [78, 350],
            [125, 285],
            [92, 325],
            [110, 304],
            [101, 312],
            [144, 277],
            [94, 324],
            [121, 295],
            [58, 383],
            [123, 288],
            [70, 363],
            [108, 303],
            [55, 393],
            [86, 335],
            [82, 342],
            [58, 385],
            [100, 313],
            [127, 289],
            [136, 280],
            [99, 318],
            [64, 366],
            [124, 286],
            [145, 276],
            [96, 326],
            [129, 283],
            [109, 305],
            [58, 382],
            [103, 316],
            [95, 327],
            [56, 391],
            [132, 279],
            [77, 349],
            [79, 349],
            [62, 376],
            [55, 398],
            [94, 329],
            [143, 277],
            [121, 294],
            [114, 299],
            [119, 294],
            [121, 290],
            [89, 330],
            [117, 295],
            [66, 364],
            [68, 368],
            [56, 387],
            [87, 332],
            [92, 327],
            [80, 346],
            [131, 280],
            [55, 396],
            [109, 303],
            [85, 338],
            [117, 296],
            [62, 374],
            [90, 335],
            [75, 352],
            [110, 301],
            [100, 317],
            [89, 335],
            [134, 278],
            [71, 362],
            [119, 297],
            [66, 367],
            [131, 281],
            [143, 276],
            [130, 285],
            [91, 327],
            [91, 328],
            [124, 288],
            [68, 364],
            [108, 305],
            [77, 347],
            [141, 276],
            [59, 377],
            [90, 332],
            [97, 321],
            [73, 358],
            [141, 277],
            [68, 361],
            [60, 379],
            [74, 353],
            [149, 276],
            [101, 316],
            [61, 372],
            [112, 307],
            [134, 280],
            [100, 316],
            [91, 331],
            [130, 287],
            [58, 384],
            [83, 343],
            [57, 385],
            [132, 282],
            [119, 295],
            [65, 369],
            [87, 331],
            [107, 305],
            [66, 371],
            [79, 345],
            [65, 371],
            [61, 374],
            [103, 313],
            [60, 375],
            [86, 332],
            [102, 312],
            [82, 343],
            [90, 333],
            [125, 291],
            [101, 315],
            [94, 327],
            [115, 298],
            [74, 355],
            [58, 389],
            [146, 276],
            [59, 386],
            [85, 336],
            [88, 335],
            [59, 379],
            [115, 301],
            [115, 302],
            [82, 340],
            [63, 367],
            [64, 372],
            [71, 365],
            [61, 375],
            [89, 333],
            [67, 368],
            [113, 303],
            [125, 287],
            [102, 316],
            [91, 333],
            [124, 290],
            [90, 331],
            [107, 306],
            [76, 350],
            [77, 350],
            [59, 378],
            [105, 313],
            [105, 307],
            [81, 345],
            [82, 345],
            [78, 352],
            [98, 320],
            [75, 350],
            [64, 367],
            [108, 308],
            [129, 281],
            [117, 298],
            [113, 300],
            [79, 350],
            [81, 346],
            [147, 276],
            [65, 370],
            [66, 365],
        ];

        for diff_arr in difficulties {
            let difficulty = Difficulty {
                num_nodes: diff_arr[0],
                better_than_baseline: diff_arr[1] as u32,
            };
            let seeds = [6131231890303; 8];
            let challenge = Challenge::generate_instance(seeds, &difficulty).unwrap();

            let start_time1 = Instant::now();
            let result_super = match clarke_wright::solve_challenge(&challenge) {
                Ok(Some(solution)) => match challenge.verify_solution(&solution) {
                    Ok(_) => "OK;".to_string(),
                    Err(e) => format!("KO;{}", e),
                },
                Ok(None) => "No solution;".to_string(),
                Err(e) => format!("Algorithm error: {}", e),
            };
            let duration1 = start_time1.elapsed().as_micros();

            let start_time2 = Instant::now();
            let result_ultimate = match clarke_wright_ultimate::solve_challenge(&challenge) {
                Ok(Some(solution)) => match challenge.verify_solution(&solution) {
                    Ok(_) => "OK;".to_string(),
                    Err(e) => format!("KO;{}", e),
                },
                Ok(None) => "No solution;".to_string(),
                Err(e) => format!("Algorithm error: {}", e),
            };
            let duration2 = start_time2.elapsed().as_micros();

            println!(
                "{:?};{:?};{};{:?};{}",
                diff_arr, duration1, result_super, duration2, result_ultimate,
            );
        }
    }
}
